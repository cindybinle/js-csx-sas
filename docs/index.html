<!DOCTYPE html>
<html lang="en" ng-app="jsoneditor" ng-cloak>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="robots" content="index, follow"/>
    <title>JSON Editor Online - view, edit and format JSON online</title>
    <meta name="description" content="JSON Editor Online - view, edit and format JSON online">
    <meta name="author" content="Thuan Le">
    <meta name="keywords"
          content="json, editor, formatter, online, format, parser, json editor, json editor online, online json editor, javascript, javascript object notation, tools, tool, json tools, treeview, open source, free, json parser, json parser online, json formatter, json formatter online, online json formatter, online json parser, format json online, json editor of thuan le, thuan le, thuanitdn, thuanitdn developer, thuan le developer">
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="http://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.5.11/jsoneditor.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/angular-resizable/1.2.0/angular-resizable.min.css">
</head>
<style>

    body, html {
        background-image: linear-gradient(to left, #ED4264, #FFEDBC);
    }

    nav h3 {
        color: #ed4867;
        font-weight: 200;
        margin-top: -12px;
    }

    .container-app {
        width: calc(100% - 40px);
        height: calc(100% - 60px);
        position: absolute;
        top: 50px;
        left: 20px;
        z-index: 0;
    }

    .container-app .container {
        position: relative;
        width: 100%;
        height: 100%;
        z-index: 1;
    }

    .container-app .container header {
        height: 40px;
        width: 100%;
        border-bottom: 2px solid #ccc;
    }

    .container-app .container .container-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #fff;
        z-index: -1;
        border-bottom-right-radius: 30px;
        border: 1px solid #ccc;
    }

    .container-app .content {
        position: relative;
        -webkit-box-flex: 1;
        -ms-flex: 1;
        flex: 1;
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-flow: row nowrap;
        flex-flow: row nowrap;
        /*justify-content: space-around;*/
        -ms-flex-line-pack: distribute;
        /*align-content: space-around;*/
    }

    .container-app .content .form-editor {
        min-width: 35%;
    }

    .container-app .content .form-tree {
        margin-left: 16px;
        width: calc(65% - 16px);
    }

    .container-app .content .resizable {
        /*flex: 0 0 100%;*/
    }

    button {
        border: 1px solid #fff;
        font-weight: 600;
        border-radius: 5px;
        font-size: 15px;
        padding: 3px;
        color: #fff;
        cursor: pointer;
        background: white;

    }

    button b {
        margin-right: 5px;
        font-weight: 800;
    }

    header button {
        margin: 7px 0 0 10px;
    }

    .btn-upload {
        border-color: #FF851B;
        color: #FF851B;
    }

    .btn-download {
        border-color: #2ECC40;
        color: #2ECC40;
    }

    .btn-save {
        border-color: #0074D9;
        color: #0074D9;
    }

    .btn-list-save {
        border-color: #001f3f;
        color: #001f3f;
    }

    .jsoneditor .jsoneditor-menu {
        background: #ed4867;
    }

    .jsoneditor .jsoneditor-menu .jsoneditor-poweredBy {
        display: none;
    }

    div.jsoneditor {
        border-color: #ed4867;
    }

    /* css upload*/
    .custom-file-input {
        margin-left: 10px;
        color: transparent;
    }

    .custom-file-input::-webkit-file-upload-button {
        visibility: hidden;
    }

    .custom-file-input::before {
        content: 'Import json file';
        color: #FF851B;
        display: inline-block;
        border: 1px solid #FF851B;
        border-radius: 3px;
        padding: 5px 8px;
        outline: none;
        white-space: nowrap;
        -webkit-user-select: none;
        cursor: pointer;
        text-shadow: 1px 1px #fff;
        font-weight: 700;
        font-size: 10pt;
    }

    .custom-file-input:hover::before {
        border-color: black;
    }

    .custom-file-input:active {
        outline: 0;
    }

    .custom-file-input:active::before {
        background: -webkit-linear-gradient(top, #e3e3e3, #f9f9f9);
    }

    body {
        padding: 20px;
    }

    /*css up;pad*/

    footer {
        text-align: center;
        font-weight: 200;
        font-size: 12px;
        height: 15px;
        line-height: 15px;
        color: #ed4867;
    }

    footer a {
        color: #ed4867;
        text-decoration: none;
    }

    .alert-error {
        position: fixed;
        top: 30px;
        right: 30px;
        padding: 10px;
        height: 30px;
        line-height: 30px;
        background: #fcdae0;
        color: #ed4867;
        border: 2px solid #ed4867;
        z-index: 9999;
        border-radius: 7px;
        box-shadow: 3px 4px 5px #987878;
        font-weight: 600;
    }

    .alert-success {
        position: fixed;
        top: 30px;
        right: 30px;
        padding: 10px;
        height: 30px;
        line-height: 30px;
        background: #d7f5f5;
        color: #3D9970;
        border: 2px solid #3D9970;
        z-index: 9999;
        border-radius: 7px;
        font-weight: 600;
        box-shadow: 3px 4px 5px #987878;
    }

    .animated {
        animation-duration: 1s;
        animation-fill-mode: both;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .fadeIn {
        animation-name: fadeIn;
    }

    @keyframes fadeInRight {
        from {
            opacity: 0;
            transform: translate3d(100%, 0, 0);
        }

        to {
            opacity: 1;
            transform: none;
        }
    }

    .fadeInRight {
        animation-name: fadeInRight;
    }

    #window-bookmark {
        position: fixed;
        top: 0;
        right: 0;
        width: 70%;
        height: 100%;
        background: white;
        box-shadow: -10px 0px 10px 1px #fffafa;
    }

    #window-bookmark .window-bookmark-container {
        position: relative;
    }

    #window-bookmark .window-bookmark-container .close-button {
        position: absolute;
        top: 0px;
        right: 20px;
        color: #ed4867;
        font-size: 50px;
        cursor: pointer;
    }

    #window-bookmark .window-bookmark-container ul {
        overflow: auto;
        list-style-type: decimal;
    }

    #window-bookmark .window-bookmark-container ul li {
        padding: 5px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
    }

    #window-bookmark .window-bookmark-container ul li:hover {
        color: #ed4867;
    }
</style>
<body ng-controller="controller">
<nav><h3>JSON EDITOR ONLINE</h3></nav>
<div class="container-app">
    <div class="container">
        <div class="container-bg"></div>
        <header>
            <input class="custom-file-input" type="file" fileread="obj.file" accept=".json"/>
            <a ng-href="{{ obj.fileDownload }}" download="{{ obj.fileName }}">
                <button class="btn-download"><b class="ion-android-download"></b>Download</button>
            </a>
            <button class="btn-save" ng-click="onClickSave()"><b class="ion-android-bookmark"></b>Save</button>
            <button class="btn-list-save" ng-click="onClickListSave()"><b class="ion-android-list"></b>List Saved
            </button>
        </header>
        <section class="content">
            <div class="form-editor" resizable r-directions="['right']" r-flex="true">
                <div ng-jsoneditor ng-model="obj.data" options="obj.options"
                     ng-style="{height: heightEditor+ 'px'}"></div>
            </div>
            <div class="form-tree">
                <div ng-jsoneditor ng-model="obj.data" options="obj2.options"
                     ng-style="{height: heightEditor+ 'px'}"></div>
            </div>
        </section>
        <footer><a href="http://thuanitdn.com" target="_blank">Created By Thuan Le</a></footer>
    </div>
</div>
<div class="alert-error animated fadeIn" ng-show="alert.errorDisplay">{{alert.errorText}}</div>
<div class="alert-success animated fadeIn" ng-show="alert.successDisplay">{{alert.successText}}</div>
<div id="window-bookmark" class="animated fadeInRight" ng-show="toggleWindowBookmark">
    <div class="window-bookmark-container">
        <span class="ion-android-close close-button" ng-click="onClickListCloseSave()"></span>
        <h3>List saved</h3>
        <br/>
        <ul>
            <li ng-repeat="data in getListSaved track by $index " ng-click="loadData(data.data, $index)">
                <span ng-show="$index == chooseBookmark" style="color: #ed4867" class="ion-android-done"></span>
                <span ng-show="$index != chooseBookmark">{{$index+1}}</span>
                {{". "+formatTime(data.date)+" | "+ getString(data.data) }}
            </li>
        </ul>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.3/angular.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.3/angular-route.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/5.5.11/jsoneditor.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular-resizable/1.2.0/angular-resizable.min.js"></script>
<script src="bower_components/ng-jsoneditor/ng-jsoneditor.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script>
  var json = {
    "Array": [1, 2, 3],
    "Boolean": true,
    "Null": null,
    "Number": 123,
    "Object": {"a": "b", "c": "d"},
    "String": "Hello World"
  };
  var Module = angular.module("jsoneditor", ['ng.jsoneditor', 'angularResizable']);

  Module.config(['$compileProvider', function ($compileProvider) {
    $compileProvider.aHrefSanitizationWhitelist(/^\s*(|blob|):/);
  }]);


  Module.controller('controller', ['$scope', '$timeout', '$window', function ($scope, $timeout, $window) {
    var today = new Date();
    $scope.obj = {
      data: json,
      options: {mode: 'code'},
      file: null,
      fileDownload: null,
      fileName: today.getDate() + "_" + today.getMonth() + "_" + today.getFullYear() + "_" + today.getHours() + "_" + today.getMinutes() + '.json'
    };
    $scope.obj2 = {data: json, options: {mode: 'tree'}};
    $scope.alert = {errorDisplay: false, errorText: '', successDisplay: false, successText: ''};
    $scope.heightEditor = window.innerHeight - 115;
    $scope.toggleWindowBookmark = false;
    $scope.getListSaved = getDataLocalStorage().list || [];
    $scope.chooseBookmark = -1;
    $scope.$watch('obj.file', function (newVal) {
      if (newVal && isJsonString(newVal)) {
        $scope.obj.data = JSON.parse(newVal);
        $scope.alert.successDisplay = true;
        $scope.alert.successText = "Import file success!";
      }
      else if (!isJsonString(newVal)) {
        $scope.alert.errorDisplay = true;
        $scope.alert.errorText = "Format json file wrong, please choose other file!";
      }
    });

    $scope.$watch('alert.errorDisplay', function (newVal) {
      if (newVal) {
        $timeout(function () {
          $scope.alert = {errorDisplay: false, errorText: '', successDisplay: false, successText: ''};
        }, 3000);
      }
    });

    $scope.$watch('alert.successDisplay', function (newVal) {
      if (newVal) {
        $timeout(function () {
          $scope.alert = {errorDisplay: false, errorText: '', successDisplay: false, successText: ''};
        }, 3000);
      }
    });

    $scope.$watch('obj.data', function (newVal) {
      var url = $window.URL || $window.webkitURL;
      $scope.obj.fileDownload = url.createObjectURL(new Blob([JSON.stringify(newVal)], {type: 'text/plain'}));
    });

    $scope.formatTime = function (time) {
      return moment(time).fromNow();
    };

    $scope.loadData = function (data, i) {
      $scope.obj.data = data;
      $scope.chooseBookmark = i;
    };

    $scope.onClickSave = function () {
      if (typeof(Storage) !== "undefined") {
        var localstorage = getDataLocalStorage();
        var list = [];
        if (typeof localstorage.list != "undefined") {
          list = localstorage.list;
        }
        list.push({date: new Date(), data: $scope.obj.data});
        localstorage.list = list;
        localStorage.setItem("json_editor_online_tl", JSON.stringify(localstorage));
        $scope.alert.successDisplay = true;
        $scope.alert.successText = "Saved!";
      }
    };

    $scope.onClickListSave = function () {
      $scope.toggleWindowBookmark = true;
    };

    $scope.onClickListCloseSave = function () {
      $scope.toggleWindowBookmark = false;
    };

    $scope.getString = function (data) {
      return JSON.stringify(data);
    }


    function getDataLocalStorage() {
      if (typeof(Storage) !== "undefined") {
        var localData = localStorage.getItem("json_editor_online_tl");
        if (localData) {
          return JSON.parse(localData);
        }
        else {
          return {
            list: []
          }
        }
      }
    }


  }]);

  //    directive

  Module.directive("fileread", [function () {
    return {
      scope: {
        fileread: "="
      },
      link: function (scope, element, attributes) {
        element.bind("change", function (changeEvent) {
          var reader = new FileReader();
          reader.onload = function (loadEvent) {
            scope.$apply(function () {
              scope.fileread = loadEvent.target.result;
            });
          }
          reader.readAsText(changeEvent.target.files[0]);
        });
      }
    }
  }]);

  function isJsonString(str) {
    try {
      JSON.parse(str);
    } catch (e) {
      return false;
    }
    return true;
  }

  // Changes XML to JSON
  function xmlToJson(xml) {

    // Create the return object
    var obj = {};

    if (xml.nodeType == 1) { // element
      // do attributes
      if (xml.attributes.length > 0) {
        obj["@attributes"] = {};
        for (var j = 0; j < xml.attributes.length; j++) {
          var attribute = xml.attributes.item(j);
          obj["@attributes"][attribute.nodeName] = attribute.nodeValue;
        }
      }
    } else if (xml.nodeType == 3) { // text
      obj = xml.nodeValue;
    }

    // do children
    if (xml.hasChildNodes()) {
      for (var i = 0; i < xml.childNodes.length; i++) {
        var item = xml.childNodes.item(i);
        var nodeName = item.nodeName;
        if (typeof(obj[nodeName]) == "undefined") {
          obj[nodeName] = xmlToJson(item);
        } else {
          if (typeof(obj[nodeName].push) == "undefined") {
            var old = obj[nodeName];
            obj[nodeName] = [];
            obj[nodeName].push(old);
          }
          obj[nodeName].push(xmlToJson(item));
        }
      }
    }
    return obj;
  }
  ;
</script>
</body>
</html>